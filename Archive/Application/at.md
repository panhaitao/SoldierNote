# at 命令

Linux下的at定时执行任务命令详解，之前说了使用crontab实现定时执行任务，假如我们只是想要让特定任务运行一次,那么，这时候就要用到at监控程序了。


## at服务

启动服务: `service atd start`


## at命令执行流程
```　　
at 2:05 tomorrow
at>exec shell commond
at> Ctrl+D
```

执行完成上述操作后，at类似打印进程，会把任务放到 /var/spool/cron/atjobs 目录中生成对应可执行的脚本，到指定时间运行对应的脚本

AT Time中的时间表示方法

```
-----------------------------------------------------------------------
时 间     例子                    说明
-----------------------------------------------------------------------
Minute    at now + 5 minutes      任务在5分钟后运行
Hour      at now + 1 hour         任务在1小时后运行
Days      at now + 3 days         任务在3天后运行
Weeks     at now + 2 weeks        任务在两周后运行
Fixed     at midnight             任务在午夜运行
Fixed     at 10:30pm              任务在晚上10点30分
Fixed     at 23:59 12/31/2018　　 任务在2018年12月31号23点59分　　
```

## 参数详解

at [-V] [-q x] [-f file] [-mldbv] time
at -c job ...
atq [-V] [-q x]
atrm [-V] job ...
-V : 印出版本编号 

-q : 使用指定的伫列(Queue)来储存，at 的资料是存放在所谓的 queue 中，使用者可以同时使用多个 queue，而 queue 的编号为 a, b, c... z 以及 A, B, ... Z 共 52 个 
-m : 即使程序/指令执行完成后没有输出结果, 也要寄封信给使用者 
-f file : 读入预先写好的命令档。使用者不一定要使用交谈模式来输入，可以先将所有的指定先写入档案后再一次读入 网络应用
-l : 列出所有的指定 (使用者也可以直接使用 atq 而不用 at -l) 
-d : 删除指定 (使用者也可以直接使用 atrm 而不用 at -d) 
-v : 列出所有已经完成但尚未删除的指定 

## at 的黑名单和白名单

在系统的 /etc 目录下可能会有两个关于 at 命令使用限制的文件，一个是黑名单(etc/at/deny)一个是白名单（/etc/at.allow），一般只有一个黑名单文件，因为大部分情况下是允许执行 at 命令的，如果使用白名单，有 100 个用户的话，岂不是要写100行，但黑名单只需要把被限制的一两个写上就行。

如果系统中有/etc/at.allow 文件，那么只有被写入该文件的用户才可以执行 at 命令（将使用者的账号写入即可，一个一行）相当于白名单文件，此时/etc/at.deny就会被忽略，相当于黑名单。
如果系统中没有/etc/at.allow文件，只有/etc/at.deny，那么被写入该文件的用户就不能使用 at 命令，黑名单对 root 不起作用。
如果两个文件都不存在，那么只有root 用户可以执行。
