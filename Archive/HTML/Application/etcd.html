<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h2 id="etcd-简介">etcd 简介</h2>
<p>etcd是一个分布式可靠的键值存储，用于存储分布式系统的关键数据。主要特性如下：</p>
<ul>
<li>基于HTTP+JSON的API</li>
<li>选SSL客户认证机制</li>
<li>使用Raft算法充分实现了分布式。</li>
<li>高效的读写性能</li>
</ul>
<p>分布式系统中的数据分为控制数据和应用数据。etcd的使用场景默认处理的数据都是控制数据，对于应用数据，只推荐数据量很小，但是更新访问频繁的情况。典型应用场景有如下几类：</p>
<ul>
<li>服务发现（Service Discovery）</li>
<li>消息发布与订阅</li>
<li>负载均衡</li>
<li>分布式通知与协调</li>
<li>分布式锁、分布式队列</li>
<li>集群监控与Leader竞选</li>
</ul>
<h2 id="etcd-工作原理">etcd 工作原理</h2>
<p>使用Raft协议来维护集群内各个节点状态的一致性。简单说，ETCD集群是一个分布式系统，由多个节点相互通信构成整体对外服务，每个节点都存储了完整的数据，并且通过Raft协议保证每个节点维护的数据是一致的。</p>
<h2 id="etcd-的安装部署">etcd 的安装部署</h2>
<h3 id="二进制安装">二进制安装</h3>
<p>以 3.2.10 版本为例，从社区网站 <a href="https://github.com/coreos/etcd/releases" class="uri">https://github.com/coreos/etcd/releases</a> 获取压缩包etcd-v3.2.10-linux-amd64.tar.gz，解压后将 etcd和etcdctl 拷贝到系统/usr/bin 下即可完成软件包安装，在使用systemd的系统上，创建对应的服务配置 /usr/lib/systemd/system/etcd.service ，即可完成安装，参考如下：</p>
<pre><code>[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
WorkingDirectory=/var/lib/etcd/
EnvironmentFile=-/etc/etcd/etcd.conf
#User=etcd
# set GOMAXPROCS to number of processors
ExecStart=/bin/bash -c &quot;GOMAXPROCS=$(nproc) /usr/bin/etcd --name=\&quot;${ETCD_NAME}\&quot; --data-dir=\&quot;${ETCD_DATA_DIR}\&quot; --listen-client-urls=\&quot;${ETCD_LISTEN_CLIENT_URLS}\&quot;&quot;
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target</code></pre>
<h2 id="etcd的单机部署参考配置">etcd的单机部署参考配置</h2>
<pre><code>ETCD_NAME=default
ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;
ETCD_LISTEN_CLIENT_URLS=&quot;http://etcd_server:2379&quot;
ETCD_ADVERTISE_CLIENT_URLS=&quot;http://etcd_server:2379&quot;</code></pre>
<ul>
<li><p>ETCD参数说明</p></li>
<li>ETCD_NAME 节点名称</li>
<li>ETCD_DATA_DIR 指定节点的数据存储目录，这些数据包括节点ID，集群ID，集群初始化配置，Snapshot文件，若未指定—wal-dir，还会存储WAL文件；</li>
<li>ETCD_LISTEN_CLIENT_URLS 对外提供服务的地址,客户端会连接到这里和 etcd 交互</li>
<li><p>ETCD_ADVERTISE_CLIENT_URLS 告知客户端url, 也就是服务的url</p></li>
<li><p>启动服务，确认运行状态</p></li>
<li>systemctl daemon-reload</li>
<li>systemctl start etcd.service</li>
<li><p>systemctl status etcd.service</p></li>
<li><p>使用 etcdctl 来验证服务运行状态</p></li>
</ul>
</body>
</html>
