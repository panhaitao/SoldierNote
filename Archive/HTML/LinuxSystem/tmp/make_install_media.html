<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="isobuilder">isobuilder</h1>
<p>ISO 制作向导</p>
<h2 id="debian-系发行版安装盘">debian 系发行版安装盘</h2>
<p>获取ISO仓库软件包列表，以debian9为例:</p>
<p>最小系统所需deb列表</p>
<pre><code>debootstrap --print-debs --no-check-gpg --include=ssh,iptables,vim,linux-image-4.9.0-1-amd64,grub-pc,grub-efi --components=main,non-free,contrib --arch=amd64 stretch /tmp http://mirrors.ustc.edu.cn/debian &gt; all_deb.list</code></pre>
<p>安装盘所需udeb列表</p>
<pre><code>wget http://10.1.10.21/server-dev/dsce-15-amd64/dists/kui/main/debian-installer/binary-amd64/Packages.gz
zcat Packages.gz | grep Filename | awk  &#39;{print $2}&#39; &gt; all_udeb.list</code></pre>
<p>通过<code>apt-get download 和 wget</code> 命令获取软件包列表,具体步骤略，创建本地仓库可阅读<a href="https://bj.git.sndu.cn/server-dev/engineering-docs-tools/blob/master/manuals/reprepro-howto.md">参考文档</a></p>
<h2 id="创建工作目录">创建工作目录:</h2>
<pre><code>git clone git@bj.git.sndu.cn:server-packages/isobuilder.git
cp -av isobuilder/iso-templet ~/iso-build/  # 拷贝一份模版目录副本
cd ~/iso-build/                             # 进入工作目录
cp -av pool dists .                         # 拷贝仓库好的本地仓库到工作目录
mkdir -pv install.amd/                      # 创建存放安装器的目录，存放`initrd.gz  vmlinuz`,
根据需要创建 preseed.cfg custom.postinstall 
find . -type f | grep -v -e ^\./\.disk -e ^\./dists | xargs md5sum &gt;&gt; md5sum.txt</code></pre>
<p>安装器下载地址: http://10.1.10.72/installer/x86/V15.1/cdrom/gtk/</p>
<h2 id="封装iso">封装ISO</h2>
<pre><code>xorriso -as mkisofs -r -V &#39;Deepin Server V15&#39;                                                             \
    -J -isohybrid-mbr /usr/lib/ISOLINUX/isohdpfx.bin                                                      \
    -J -joliet-long                                                                                       \
    -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot                                           \
    -boot-load-size 4 -boot-info-table -eltorito-alt-boot                                                 \
    -e boot/grub/efi.img -no-emul-boot -isohybrid-gpt-basdat -isohybrid-apm-hfsplus  iso-build            \
    -o deepin-server-v15.iso</code></pre>
</body>
</html>
