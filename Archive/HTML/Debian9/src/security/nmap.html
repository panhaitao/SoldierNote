<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>rk Mapper网络映射器) 是一款开放源代码的网络探测和安全审核的工具。它的设计目标是快速地扫描大型网络，当然用它扫描单个主机也没有问题。Nmap以新颖的方式使用原始IP报文来发现网络上有哪些主机，那些主机提供什么服务(应用程序名和版本)，那些服务运行在什么操作系统(包括版本信息)，它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。虽然Nmap通常用于安全审核，许多系统管理员和网络管理员也用它来做一些日常的工作，比如查看整个网络的信息，管理服务升级计划，以及监视主机和服务的运行。</p>
<p>Nmap输出的是扫描目标的列表，以及每个目标的补充信息，至于是哪些信息则依赖于所使用的选项。“所感兴趣的端口表格”是其中的关键。那张表列出端口号，协议，服务名称和状态。状态可能是open(开放的)，filtered(被过滤的)， closed(关闭的)，或者unfiltered(未被过滤的)。Open(开放的)意味着目标机器上的应用程序正在该端口监听连接/报文。 filtered(被过滤的)意味着防火墙，过滤器或者其它网络障碍阻止了该端口被访问，nmap无法得知它是open(开放的)还是closed(关闭的)。closed(关闭的)端口没有应用程序在它上面监听，但是他们随时可能开放。当端口对nmap的探测做出响应，但是nmap无法确定它们是关闭还是开放时，这些端口就被认为是unfiltered(未被过滤的) 如果nmap报告状态组合 open|filtered 和closed|filtered时，那说明nmap无法确定该端口处于两个状态中的哪一个状态。当要求进行版本探测时，端口表也可以包含软件的版本信息。当要求进行IP协议扫描时(-sO)，nmap提供关于所支持的IP协议而不是正在监听的端口的信息。</p>
<p>除了所感兴趣的端口表，nmap还能提供关于目标机的进一步信息，包括反向域名，操作系统猜测，设备类型，和MAC地址。</p>
<p>nmap核心功能 Ø 主机发现（Host Discovery） 用于发现目标主机是否处于活动状态(Active)。Nmap提供U了多种检测机制，可以更 有效地辨识主机。例如可用来列举目标网络中哪些主机已经开启，类似于Ping命令的 功能。 Ø 端口扫描（Port Scanning） 用于扫描主机上的端口状态。Nmap可以将端口识别为开放(Open)、关闭(Closed)、 过滤（Filtered）、未过滤（Unfiltered）、开放|过滤（Open|Filtered）、关闭|过滤 （Closed|Filtered）。默认情况下，Nmap会扫描1000个常用的端口，可以覆盖大 多数基本应用情况。 Ø 版本侦测（Version Detection） 用于识别端口上运行的应用程序与程序版本。Nmap目前可以识别数千种应用的签名 （Signatures）,检测数百种应用协议。而对于不识别的应用，Nmap默认会将应用的 指纹(Fingerprint)打印出来，如果用户确知该应用程序，那么用户可以将信息提交到 社区，为社区做贡献。 Ø 操作系统侦测（OS detection） 用于识别目标机的操作系统类型、版本编号及设备类型。Nmap目前提供了上千种操 作系统或设备的指纹数据库，可以识别通用PC系统、路由器、交换机等设备类型。 Ø 防火墙/IDS规避（Firewall/IDS evasion） nmap提供多种机制来规避防火墙、IDS的的屏蔽和检查，便于秘密地探查目标机的 状况。 Ø 基本的规避方式包括：分片（Fragment）/IP诱骗（IP decoys）/IP伪装（IP spoofing）/MAC地址伪装（MAC spoofing）等等。 Ø NSE脚本引擎(Nmap Scripting Engine) NSE是Nmap最强大最灵活的特性之一，可以用于增强主机发现、端口扫描、版本侦 测、操作系统侦测等功能，还可以用来扩展高级的功能如web扫描、漏洞发现、漏洞 利用等等。nmap使用Lua语言来作为NSE脚本语言，目前的Nmap脚本库已经支 持350多个脚本。</p>
<p>nmap安装 在深度服务器操作系统nmap工具的安装方式有两种： Tasksel安装方式 1. 配置好软件源，配置软件源请参考本手册的2.3节。 2. 在命令行执行tasksel命令，在打开的tasksel软件选择界面，选中“nmap”， 光标移动到“ok/确定”按钮，敲击回车键，系统就开始安装。</p>
<p>命令行安装方式 1. 配置好软件源，配置软件源请参考本手册的2.3节。 2. 在命令行执行命令apt-get install nmap或aptitude install nmap，系统就开始安装。</p>
<p>nmap语法 nmap的语法格式为 nmap [Scan Type...] [Options] {target specification} 即nmap [扫描类型 ...] [选项] {扫描目标说明} 其中，target specification可以是主机名、ip地址和网络等。</p>
<p>nmap目标说明常用参数见表4.6</p>
<p>表4.6 nmap目标说明常用参数 扫描类型 参数 含义 主机发现 -sL 列表扫描，仅将指定的目标IP列举出来，不进行主机发现 -sP 只利用ping扫描进行主机发现，不进行端口扫描 -P0 将所有指定的主机视作开启的，跳过主机发现的过程 -PE/PP/PM 发送ICMP Type 8 （回声请求）报文，期待从运行的主机得到一个type 0 （回声相应）报文 -n 不用域名解析，加快扫描速度 -R 为所有目标IP地址作反向域名解析</p>
<p>-PS/PA/PU 发送一个带SYN/ACK标志的TCP报文或空的UDP报文到指定端口 端口扫描 -sT/sA/sW/sM 建立TCP连接，容易被记录；对原始报文控制少，效率低/TCP ACK扫描，只设置ACK标志位，区分被过滤与未被过滤的/TCP窗口扫描，依赖于互联网上少数系统的实现细节，因此可信度不高；根据窗口大小来判断端口是开放的（正数）还是关闭的（0）/TCP Maimon扫描，探测报文是FIN/ACK，端口开放或关闭，都对这样的报文响应RST报文，但如果端口开放，许多基于BSD的系统只是丢弃该探测报文 -sN/sF/sX TCP Null,Fin, Xmas扫描，从RFC挖掘的微妙方法来区分开放关闭端口；除了探测报文的标志位不同，三种扫描在行为上一致 --scanflags 通过指定任意的TCP标志位来设计扫描，可以是数字标记值，也可以使用字符名如URG/ACK/PSH/RST/SYN/FIN -sI Idlescan，利用zombie主机上已知IP分段ID序列生成算法来窥探目标上开放端口的信息，极端隐蔽，可以指定端口号，否则默认80 -sO IP协议扫描，可以确定目标机支持哪些IP协议（TCP, ICMP, IGMP） 版本侦测 -sV 打开版本探测 --version-intensity 设置版本扫描强度，范围为0-9，默认是7，强度越高，时间越长，服务越可能被正确识别 --version-light 是—version-intensity2的别名 --version-all 是—version-intensity9的别名 --version-trace 跟踪版本扫描活动，打印出详细的关于正在进行的扫描的调试信息 -sR RPC扫描,这种方法和许多端口扫描方法联合使用。它对所有被发现开放的TCP/UDP端口执行SunRPC程序NULL命令，来试图 确定它们是否RPC端口，如果是， 是什么程序和版本号. 操作系统探测 -O 启用操作系统检测，也可用-A同时启用操作系统检测和版本检测</p>
<p>--osscan-limit 针对指定的目标进行操作系统检测 --osscan-guess 推测操作系统检测结果，当Nmap无法确定所检测的操作系统时，会尽可能地提供最相近的匹配（通过猜测/推测） 防火墙/IDS规避 -f 报文分段，要求扫描时(包挺ping扫描)使用 小的IP包分段。其思路是将TCP头分段在几个包中，使得包过滤器、IDS以及其它工具的检测更加困难。 -S 源地址哄骗，说明所需发送包的接口IP地址 -e 使用指定接口 --source-port /-g 源端口哄骗，仅依赖于源端口号就信任数据流是一种常见的错误配置，这个问题非常 好理解。 --ttl 设置IP time-to-live域，设置IPv4报文的time-to-live域为指定的值。 --spoof-mac MAC地址哄骗，要求Nmap在发送原以太网帧时使用指定的MAC地址，这个选项隐含了 --send-eth选项，以保证Nmap真正发送以太网包。 输出 -oN 标准输出 -oX XML输出 -oS 脚本小子输出类似于交互工具输出 -oG Grep输出 -oA 输出至所有格式 --append-output 当使用文件作为输出格式，如-oX或-oN， 默认该文件被覆盖，如果使用该选项，表示在输出文件中添加，而不是覆盖原文件。 时间和性能 -T[0-6] 设置时间模板,使用6个时间模板，使用时采用-T选项及数字(0 - 5) 或名称。模板名称有paranoid(0)、sneaky (1)、polite (2)、normal(3)、 aggressive (4)和insane (5)。前两种模式用于IDS躲避，Polite模式降低了扫描速度以使用更少的带宽和目标主机资源。默认模式为Normal，因此-T3 实际上是未做任何优化。Aggressive模式假设用户具有合适及可靠的网络从而加速 扫描。Insane模式假设用户具有特别快的网络或者愿意为获得速度而牺牲准确性。 --min-hostgroup/ max-hostgroup 调整并行扫描组的大小,Nmap具有并行扫描多主机端口或版本的能力，Nmap将多个目标IP地址空间分成组，然后在同一时间对一个组进行扫描。通常，大的组更有效。缺 点是只有当整个组扫描结束后才会提供主机的扫描结果。 --min-parallelism/ max-parallelism 调整探测报文的并行度,用于主机组的探测报文数量，可用于端口扫描和主机发现。默认状态下，Nmap基于网络性能计算一个理想的并行度，这个值经常改变。 --min-rtt-timeout/ max-rtt-timeout/ initial-rtt-timeout 调整探测报文超时,Nmap使用一个运行超时值来确定等待探测报文响应的时间，随后会放弃或重新发送探测报文。Nmap基于上一个探测报文的响应时间来计算超时值，如果网络延迟比较显著和不定，这个超时值会增加几秒。初始值的比较保守(高)，而当Nmap扫描无响应的主机时，这个保守值会保持一段时间。 --host-timeout 放弃低速目标主机,通常使用1800000 来保证Nmap不会在单个主机上使用超过半小时的时间。 --scan-delay/ --max-scan-delay 调整探测报文的时间间隔,用于Nmap控制针对一个主机发送探测报文的等待时间(毫秒)，在带宽控制的情况下这个选项非常有效。</p>
<p>Nmap更多更详细的选项参数及其含义，用户可以直接执行man nmap查看。</p>
<p>Nmap应用举例 例1 扫描主机scanme.nmap.org中 所有的保留TCP端口,-v选项启用细节模式 nmap -v scanme.nmap.org</p>
<p>例2 进行秘密SYN扫描，对象为主机Saznme所在的“C类”网段的255台主机。同时尝试确定每台工作主机的操作系统类型。因为进行SYN扫描 和操作系统检测，这个扫描需要有根权限。 nmap -sS -O scanme.nmap.org/24</p>
<p>例3 随机选择100台主机扫描是否运行Web服务器(80端口)。由起始阶段发送探测报文来确定主机是否工作非常浪费时间，而且只需探测主机的一个端口，因此使用-P0禁止对主机列表 nmap -v -iR 100 -P0 -p 80</p>
<p>例4 扫描256个IP地址，查找Web服务器(不ping)，将结果以Grep和XML格式保存 nmap -P0 -p80 -oX /tmp/pb-port80scan.xml -oG /tmp/pb-port80scan.gnmap 10.1.11.241/24</p>
</body>
</html>
